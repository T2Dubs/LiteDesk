<Window x:Class="LiteDesk.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        xmlns:local="clr-namespace:LiteDesk"
        xmlns:core="clr-namespace:LiteDesk.Core.Models;assembly=LiteDesk.Core"
        mc:Ignorable="d"
        Title="LiteDesk" Height="800" Width="1000"
        MinHeight="800" MinWidth="1000"
        Background="#1e1e2f"
        WindowStartupLocation="CenterScreen"
        FontFamily="Segoe UI" Foreground="#eeeeee">
    <Window.Resources>
        <!-- Client List Template -->
        <local:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>
        <local:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <DataTemplate x:Key="ClientItemTemplate" DataType="{x:Type core:Client}">
            <Border Padding="8" Margin="0,4" Background="#1e1e2f" 
                    HorizontalAlignment="Stretch" CornerRadius="6"
                    BorderBrush="#444" BorderThickness="1">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <TextBlock Grid.Row="0" Text="{Binding Name}" FontWeight="Bold" FontSize="14"/>
                    <TextBlock Grid.Row="1" Text="{Binding PhoneNumber}" Foreground="#aaa" Margin="0,0,12,0"
                                Visibility="{Binding PhoneNumber, Converter={StaticResource NullToVisibilityConverter}}" />
                    <TextBlock Grid.Row="2" Text="{Binding Email}" Foreground="#aaa"
                                Visibility="{Binding Email, Converter={StaticResource NullToVisibilityConverter}}" />
                    <!--<StackPanel  Orientation="Horizontal" Margin="0,4,0,0">
                    </StackPanel>-->
                    <TextBlock Grid.Row="3" Text="{Binding CreatedAt, StringFormat='Joined: {0:MMM dd, yyyy}'}" Foreground="#888" FontSize="12" Margin="0,2,0,0"/>
                    <TextBlock Grid.Row="4" Text="{Binding Notes}" FontStyle="Italic" Foreground="#aaa"
                               TextTrimming="CharacterEllipsis" TextWrapping="NoWrap" Margin="0,4,0,0"
                       Visibility="{Binding Notes, Converter={StaticResource NullToVisibilityConverter}}"/>
                </Grid>
            </Border>
        </DataTemplate>
        
        <!-- Call Log Template -->
        <DataTemplate x:Key="CallLogItemTemplate" DataType="{x:Type core:CallLog}">
            <Border Padding="8" Margin="0,4" Background="#1e1e2f"
                    HorizontalAlignment="Stretch" CornerRadius="6" 
                    BorderBrush="#444" BorderThickness="1">
                <StackPanel>
                    <TextBlock Text="{Binding Summary}" TextTrimming="CharacterEllipsis" FontWeight="Bold" TextWrapping="NoWrap"/>
                    <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                        <TextBlock Text="{Binding ContactMethod}" Foreground="#aaa" Margin="0,0,12,0"/>
                        <TextBlock Text="{Binding CallDate, StringFormat='{}{0:MMM dd, yyyy}'}" Foreground="#aaa"/>
                    </StackPanel>
                </StackPanel>
            </Border>
        </DataTemplate>
    </Window.Resources>
    <Grid x:Name="RootGrid">
        <Grid x:Name="MainContent" Margin="20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="300" />
                <ColumnDefinition Width="8*" />
            </Grid.ColumnDefinitions>

            <!-- Clients -->
            <Border Background="#2a2a3d" CornerRadius="12" Padding="16" Margin="0,0,12,0"
                BorderBrush="#444" BorderThickness="0" Grid.Column="0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid Grid.Row="0">
                        <Grid.RowDefinitions>
                            <RowDefinition />
                            <RowDefinition />
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="3*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Clients" FontSize="22" FontWeight="Bold" 
                                   Grid.ColumnSpan="2"
                                   Grid.Row="0" Margin="0,0,0,12"/>
                        <TextBox Grid.Row="1" Grid.Column="0" Style="{StaticResource ModernTextBox}"
                                 x:Name="ClientsFilter" Margin="0,0,10,10"
                                 KeyDown="ClientsFilter_KeyDown"/>
                        <Button Content="Filter" Click="FilterClients_Click"
                                Grid.Row="1" Grid.Column="1" x:Name="FilterButton"
                                Style="{StaticResource ModernButtonStyle}" Margin="0,0,0,10"/>
                    </Grid>
                    <ListBox x:Name="ClientsList" 
                         MouseDoubleClick="ClientsList_MouseDoubleClick"
                         Background="#1e1e2f" Foreground="White"
                         BorderBrush="#444" BorderThickness="1"
                         SelectionChanged="ClientsList_SelectionChanged"
                         Grid.Row="1" HorizontalContentAlignment="Stretch"
                         ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                         ScrollViewer.VerticalScrollBarVisibility="Auto"
                         ItemTemplate="{StaticResource ClientItemTemplate}"/>
                    <Grid Margin="0,4,0,4" Grid.Row="2">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Button Content="Add Client" Click="AddClient_Click" Margin="0,0,8,0"
                            Grid.Column="0"
                            Style="{StaticResource ModernButtonStyle}"/>
                        <Button Content="Refresh" Click="RefreshClients_Click"
                            Grid.Column="1"
                            Style="{StaticResource ModernButtonStyle}"/>
                    </Grid>
                </Grid>
            </Border>

            <!-- Call Logs -->
            <Grid Grid.Column="1">
                <!-- Call Log Records -->
                <Grid.RowDefinitions>
                    <RowDefinition Height="3*"/>
                    <RowDefinition Height="2*"/>
                </Grid.RowDefinitions>
                <Border Background="#2a2a3d" CornerRadius="12" Padding="16" Margin="0,0,12,12"
                    BorderBrush="#444" BorderThickness="0" Grid.Row="0" >
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <TextBlock Text="Call Logs" FontSize="22" FontWeight="Bold" 
                               Grid.Row="0" Margin="0,0,0,12"/>
                        <ScrollViewer VerticalScrollBarVisibility="Auto"
                                      Grid.Row="1" Focusable="False"
                                      HorizontalScrollBarVisibility="Disabled"
                                      Background="#1e1e2f" Foreground="White"
                                      Padding="12">
                            <ItemsControl x:Name="CallLogs" ItemsSource="{Binding}"
                                          Focusable="False" IsHitTestVisible="True">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Margin="0,0,0,24">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="*"/>
                                            </Grid.RowDefinitions>
                                            <ToggleButton Content="{Binding Year}" IsChecked="{Binding IsExpanded, Mode=TwoWay}"
                                                          FontSize="18" FontWeight="Bold" Grid.Row="0"
                                                          Style="{StaticResource ModernToggleButtonStyle}" Margin="0,0,0,8"/>
                                            <ItemsControl ItemsSource="{Binding Months}" Grid.Row="1"
                                                          Focusable="False" IsHitTestVisible="True"
                                                          Visibility="{Binding IsExpanded, Converter={StaticResource BoolToVisibilityConverter}}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Grid Margin="0,0,0,8">
                                                            <Grid.RowDefinitions>
                                                                <RowDefinition Height="Auto"/>
                                                                <RowDefinition Height="*"/>
                                                            </Grid.RowDefinitions>
                                                            <ToggleButton Content="{Binding MonthName}" IsChecked="{Binding IsExpanded, Mode=TwoWay}"
                                                                          FontSize="16" FontWeight="SemiBold" Grid.Row="0"
                                                                          Style="{StaticResource ModernToggleButtonStyle}" Margin="8,0,0,0"/>
                                                            <ListBox ItemsSource="{Binding Logs}" Grid.Row="1"
                                                                     MouseDoubleClick="CallLogs_MouseDoubleClick"
                                                                     PreviewMouseWheel="ListBox_PreviewMouseWheel"
                                                                     Visibility="{Binding IsExpanded, Converter={StaticResource BoolToVisibilityConverter}}"
                                                                     Background="#1e1e2f" Foreground="White"
                                                                     BorderBrush="#444" BorderThickness="0" HorizontalContentAlignment="Stretch"
                                                                     ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                                                     ScrollViewer.VerticalScrollBarVisibility="Auto">               
                                                                <ListBox.ItemTemplate>
                                                                    <DataTemplate>
                                                                        <Border Padding="12" Margin="12,0,0,8"
                                                                                Background="#1e1e2f" CornerRadius="6" 
                                                                                BorderBrush="#444" BorderThickness="1">
                                                                            <Grid>
                                                                                <Grid.RowDefinitions>
                                                                                    <RowDefinition Height="Auto"/>
                                                                                    <RowDefinition Height="*"/>
                                                                                </Grid.RowDefinitions>
                                                                                <TextBlock Text="{Binding Summary}" TextTrimming="CharacterEllipsis"
                                                                                           Grid.Row="0"
                                                                                           MaxHeight="40"
                                                                                           FontWeight="Bold" TextWrapping="Wrap"/>
                                                                                <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,4,0,0">
                                                                                    <TextBlock Text="{Binding ContactMethod}" Foreground="#aaa" Margin="0,0,12,0"/>
                                                                                    <TextBlock Text="{Binding CallDate, StringFormat='{}{0:MMM dd, yyyy}'}" Foreground="#aaa"/>
                                                                                </StackPanel>
                                                                            </Grid>
                                                                        </Border>
                                                                    </DataTemplate>
                                                                </ListBox.ItemTemplate>
                                                            </ListBox>
                                                        </Grid>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </Grid>
                </Border>

                <!-- New Call Logs -->
                <Border Background="#2a2a3d" CornerRadius="12" Padding="16" Margin="0,0,12,0"
                    BorderBrush="#444" BorderThickness="0" Grid.Row="1">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid Grid.Row="0" Margin="0,4,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="250"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Add New Call Log" FontWeight="SemiBold" FontSize="18"
                                       Grid.Column="0" Margin="0,10,0,4"/>
                            <ComboBox x:Name="ContactMethodInput" Style="{StaticResource ModernComboBox}"
                                      Margin="10,10,10,10" MinWidth="150"
                                      SelectedIndex="0" Grid.Column="2">
                                <ComboBoxItem Content="Phone Call" MinWidth="150"/>
                                <ComboBoxItem Content="Email" MinWidth="150"/>
                                <ComboBoxItem Content="In Person" MinWidth="150"/>
                            </ComboBox>
                            <Grid Grid.Column="1">
                                <Grid.RowDefinitions>
                                    <RowDefinition />
                                    <RowDefinition />
                                </Grid.RowDefinitions>
                                <TextBlock Text="Contact Date:" 
                                           FontWeight="SemiBold" FontSize="14" 
                                           Grid.Row="0" Margin="4,0,0,0"/>
                                <DatePicker x:Name="CallDateInput"
                                            Grid.Row="1"
                                            SelectedDate="{x:Static sys:DateTime.Now}"
                                            Style="{StaticResource ModernDatePicker}" />        
                            </Grid>
                        </Grid>
                        <TextBlock Text="Summary:" FontWeight="SemiBold" FontSize="14" Margin="0,10,0,4" Grid.Row="1"/>
                        <RichTextBox x:Name="SummaryInput" Margin="0,4" Padding="4"
                                    Background="#1e1e2f" Foreground="White" BorderBrush="#555"
                                    VerticalScrollBarVisibility="Auto" Grid.Row="2" />
                        <Button Content="Add Call Log" Click="AddCallLog_Click" Margin="0,4,0,8"
                            Grid.Row="3"
                            Style="{StaticResource ModernButtonStyle}"/>
                    </Grid>
                </Border>
            </Grid>
        </Grid>
        
        <!-- Client Overlay -->
        <Grid x:Name="ClientSlideIn">
            <Grid.RowDefinitions>
                <RowDefinition Height="3*"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Rectangle x:Name="ClientOverlayBackground" Grid.RowSpan="2"
                       Fill="#1e1e2f" Opacity="0"
                       Visibility="Collapsed" Panel.ZIndex="97"
                       IsHitTestVisible="False"/>
            <local:ClientInfo x:Name="ClientOverlay"
                              Visibility="Collapsed" Grid.Row="0"
                              RenderTransformOrigin="0.5,0" Panel.ZIndex="98">
                <local:ClientInfo.RenderTransform>
                    <TranslateTransform Y="-600"/>
                </local:ClientInfo.RenderTransform>
            </local:ClientInfo>
        </Grid>
        
        <!-- Call Log Overlay -->
        <Grid x:Name="CallLogSlideIn">
            <Grid.RowDefinitions>
                <RowDefinition Height="3*"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Rectangle x:Name="CallLogOverlayBackground" Grid.RowSpan="2"
                       Fill="#1e1e2f" Opacity="0"
                       Visibility="Collapsed" Panel.ZIndex="97"
                       IsHitTestVisible="False"/>
            <local:CallLogInfo x:Name="CallLogOverlay"
                               Visibility="Collapsed" Grid.Row="0"
                               RenderTransformOrigin="0.5,0" Panel.ZIndex="98">
                <local:CallLogInfo.RenderTransform>
                    <TranslateTransform Y="-600"/>
                </local:CallLogInfo.RenderTransform>
            </local:CallLogInfo>
        </Grid>
        
        <!-- Warning Popup -->
        <Border x:Name="NotificationPopup"
                    Background="#ff4b5c"
                    CornerRadius="8"
                    Padding="10"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Top"
                    Margin="0,10,10,0"
                    Width="300"
                    Visibility="Collapsed"
                    Grid.ColumnSpan="2"
                    Panel.ZIndex="99"
                    Opacity="0">
            <TextBlock x:Name="NotificationText"
                Foreground="White"
                FontWeight="Bold"
                TextWrapping="Wrap" />
        </Border>
        
        <!-- Help Button -->
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition />
                <ColumnDefinition />
            </Grid.ColumnDefinitions>
            <Border x:Name="HelpButton"
                    Background="#00ACC1"
                    CornerRadius="12"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Top"
                    Margin="10,10"
                    Width="24"
                    Height="24"
                    Grid.Column="1"
                    Panel.ZIndex="99"
                    Cursor="Hand"
                    MouseLeftButtonDown="HelpButton_Click">
                <Viewbox>
                    <Grid Width="24" Height="24">
                        <Path Data="M5.933.87a2.89 2.89 0 0 1 4.134 0l.622.638.89-.011a2.89 2.89 0 0 1 2.924 2.924l-.01.89.636.622a2.89 2.89 0 0 1 0 4.134l-.637.622.011.89a2.89 2.89 0 0 1-2.924 2.924l-.89-.01-.622.636a2.89 2.89 0 0 1-4.134 0l-.622-.637-.89.011a2.89 2.89 0 0 1-2.924-2.924l.01-.89-.636-.622a2.89 2.89 0 0 1 0-4.134l.637-.622-.011-.89a2.89 2.89 0 0 1 2.924-2.924l.89.01zM7.002 11a1 1 0 1 0 2 0 1 1 0 0 0-2 0m1.602-2.027c.04-.534.198-.815.846-1.26.674-.475 1.05-1.09 1.05-1.986 0-1.325-.92-2.227-2.262-2.227-1.02 0-1.792.492-2.1 1.29A1.7 1.7 0 0 0 6 5.48c0 .393.203.64.545.64.272 0 .455-.147.564-.51.158-.592.525-.915 1.074-.915.61 0 1.03.446 1.03 1.084 0 .563-.208.885-.822 1.325-.619.433-.926.914-.926 1.64v.111c0 .428.208.745.585.745.336 0 .504-.24.554-.627"
                              Fill="White"
                              VerticalAlignment="Center"
                              HorizontalAlignment="Center"/>
                    </Grid>
                </Viewbox>
            </Border>
        </Grid>
    </Grid>
</Window>